{
  http_port 8080
  https_port 8443
}

# Main domain redirect to www
vm7.ai:8443 {
  tls ../../../.certs/vm7.ai.pem ../../../.certs/vm7.ai-key.pem
  redir https://www.vm7.ai:8443{uri} permanent
}

# Web application
www.vm7.ai:8443 {
  tls ../../../.certs/www.vm7.ai.pem ../../../.certs/www.vm7.ai-key.pem
  reverse_proxy localhost:3000
}

# Docs application
docs.vm7.ai:8443 {
  tls ../../../.certs/docs.vm7.ai.pem ../../../.certs/docs.vm7.ai-key.pem
  reverse_proxy localhost:3001
}

# Platform application (app)
platform.vm7.ai:8443 {
  tls ../../../.certs/platform.vm7.ai.pem ../../../.certs/platform.vm7.ai-key.pem
  reverse_proxy localhost:3002
}

# HTTP redirects to HTTPS
http://vm7.ai:8080 {
  redir https://www.vm7.ai:8443{uri} permanent
}

http://www.vm7.ai:8080 {
  redir https://www.vm7.ai:8443{uri} permanent
}

http://docs.vm7.ai:8080 {
  redir https://docs.vm7.ai:8443{uri} permanent
}

http://platform.vm7.ai:8080 {
  redir https://platform.vm7.ai:8443{uri} permanent
}
